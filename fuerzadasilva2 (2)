DROP VIEW factorgol;



CREATE VIEW FACTORLOCAL
AS
(SELECT  T1.EQUIPOLOCAL AS EQU,Round(Avg(T1.GOLESLOCAL-T1.GOLESVISITANTE),5) AS GOLLOC
FROM FN3PARTIDOFUTBOL T1,FN3EQUIPOFUTBOL T2
WHERE
T2.TIPOEQUIPO='SEL'
AND T1.COMPETICION<>'AMISTOSO'
AND t1.valido='S'
AND t1.fechapartido>dat('19920101')
AND T1.EQUIPOLOCAL=T2.CODIGO
GROUP BY t1.equipolocal);


CREATE VIEW FACTORVIS     AS
(SELECT  T1.EQUIPOVISITANTE AS EQU,Round(Avg(T1.GOLESVISITANTE-T1.GOLESLOCAL),5) AS GOLVIS
FROM FN3PARTIDOFUTBOL T1,FN3EQUIPOFUTBOL T2
WHERE
T2.TIPOEQUIPO='SEL'
AND T1.COMPETICION<>'AMISTOSO'
AND t1.valido='S'
AND t1.fechapartido>dat('19920101')
AND T1.EQUIPOVISITANTE=T2.CODIGO
GROUP BY t1.equipoVISITANTE );






CREATE VIEW FACTORGOL AS
SELECT LOC.EQU,GOLLOC+GOLVIS  AS GOL
FROM
(SELECT  T1.EQUIPOLOCAL AS EQU,Round(Avg(T1.GOLESLOCAL-T1.GOLESVISITANTE),5) AS GOLLOC
FROM FN3PARTIDOFUTBOL T1,FN3EQUIPOFUTBOL T2
WHERE
T2.TIPOEQUIPO='SEL'
AND T1.COMPETICION<>'AMISTOSO'
AND t1.valido='S'
AND t1.fechapartido>dat('19920101')
AND T1.EQUIPOLOCAL=T2.CODIGO
GROUP BY t1.equipolocal) LOC,
(SELECT  T1.EQUIPOVISITANTE AS EQU,Round(Avg(T1.GOLESVISITANTE-T1.GOLESLOCAL),5) AS GOLVIS
FROM FN3PARTIDOFUTBOL T1,FN3EQUIPOFUTBOL T2
WHERE
T2.TIPOEQUIPO='SEL'
AND T1.COMPETICION<>'AMISTOSO'
AND t1.valido='S'
AND t1.fechapartido>dat('19920101')
AND T1.EQUIPOVISITANTE=T2.CODIGO
GROUP BY t1.equipoVISITANTE ) VIS
WHERE
LOC.EQU=VIS.EQU
ORDER BY GOL DESC

CREATE TABLE fn3fuerzaequipoaux
as
SELECT equ AS equipo,dat('19920301') AS fecha,gol AS fuerza FROM FACTORGOL ORDER BY gol



SELECT CASA.EQU,Round(CASA.FACTOR+FUERA.FACTOR,3) AS FAC
FROM
(
SELECT T1.EQUIPOLOCAL AS EQU,Avg((GOLESLOCAL - GOLESVISITANTE)*T2.GOL) AS factor
FROM FN3PARTIDOFUTBOL T1,FACTORGOL T2
WHERE
--T1.EQUIPOLOCAL='SPA'  / and
t1.competicion<>'AMISTOSO'
AND t1.valido='S'
AND fechapartido>dat('19920101')
AND T1.EQUIPOVISITANTE=T2.EQU
GROUP BY  T1.EQUIPOLOCAL) CASA ,
(
SELECT T1.EQUIPOVISITANTE AS EQU,Avg(((GOLESVISITANTE-GOLESLOCAL)+T2.GOL)*T2.GOL) AS factor
FROM FN3PARTIDOFUTBOL T1,FACTORGOL T2
WHERE
--T1.EQUIPOVISITANTE='SPA'  / and
t1.competicion<>'AMISTOSO'
AND t1.valido='S'
AND fechapartido>dat('19920101')
AND T1.EQUIPOLOCAL=T2.EQU
GROUP BY  T1.EQUIPOVISITANTE) FUERA
WHERE
CASA.EQU=FUERA.equ
ORDER BY FAC







CREATE VIEW FUERZALOCAL AS
 (SELECT  LOC,Avg(GOLCOR) FUELOC ,Count(*) AS NUM
 FROM
(SELECT T1.EQUIPOLOCAL AS LOC,T1.EQUIPOVISITANTE AS VIS,GOLESLOCAL-GOLESVISITANTE-0.5+T3.GOLVIS AS  GOLCOR
-- AS factor
FROM FN3PARTIDOFUTBOL T1,FACTORLOCAL T2,FACTORVIS T3
WHERE
--T1.EQUIPOLOCAL='SPA'   and
t1.competicion<>'AMISTOSO'
AND t1.valido='S'
AND fechapartido>dat('19920101')
AND T1.EQUIPOVISITANTE=T3.EQU
AND T1.EQUIPOLOCAL=T2.EQU)
GROUP BY LOC  )

SELECT * FROM FUERZALOCAL ORDER BY FUELOC;



TRUNCATE TABLE fn3fuerzaequipoaux;

SELECT Count('x')
FROM fn3fuerzaequipoaux;

 CREATE TABLE fn3fuerzaequipoaux

 INSERT INTO fn3fuerzaequipoaux
SELECT equ AS equipo,dat('19920301') AS fecha,gol AS fuerza FROM FACTORGOL ORDER BY gol

SELECT * FROM      fn3fuerzaequipoaux
WHERE  fecha=dat('19920301')

SELECT avg(fuerza)
FROM      fn3fuerzaequipoaux
WHERE  fecha=dat('19920301')

UPDATE   fn3fuerzaequipoaux
SET fuerza=fuerza+0.753312201834862385321100917431192660550
